# Requirements - ソクラテス式対話エンジン

## 背景・目的

宿題コーチロボットのコア機能として、「答えを教えず、質問で子供を導く」ソクラテス式対話エンジンを実装する。

### 背景

- 既存の学習アプリは答えを即座に表示し、子供の思考プロセスが育たない
- 本プロジェクトでは、子供が「自分で考え、自分で気づく」プロセスを支援することが目的
- PoC（技術検証）でGoogle ADK + Gemini Live APIの動作確認が完了済み

### 目的

1. 子供の発話に応じて、理解を確認する質問を動的に生成する
2. 最終的に子供自身が答えに気づくように誘導する
3. 小学校低学年（1〜3年生）に適した語彙・表現を使用する

---

## 要求事項

### 機能要件

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-01 | 子供の発話（問題の読み上げ）に対し、理解確認の質問を生成する | 高 |
| FR-02 | 子供の回答を分析し、次の質問を動的に生成する | 高 |
| FR-03 | 対話履歴を管理し、コンテキストを維持する | 高 |
| FR-04 | 質問タイプ（理解確認/思考誘導/ヒント）を適切に選択する | 高 |
| FR-05 | 同じ質問を連続して繰り返さない | 中 |
| FR-06 | 対話のトーン（励まし/中立/共感）を状況に応じて変更する | 中 |

### 非機能要件

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-01 | 応答生成時間 | < 3秒（PoC実績: 約5秒、プレビュー版制約） |
| NFR-02 | 5ターン以内に子供を答えの方向に導ける | 80%のケース |
| NFR-03 | 質問の語彙レベル | 小学校低学年が理解できるレベル |
| NFR-04 | テストカバレッジ | 80%以上 |

### 制約条件

1. **技術スタック**: FastAPI + Python 3.10+ + Google ADK
2. **モデル**: gemini-2.5-flash-native-audio-preview（Gemini Live API）
3. **TDD必須**: Red-Green-Refactorサイクルを遵守
4. **セキュリティ**: 子供のデータを扱うため、プライバシー保護を最優先

---

## 対象範囲

### In Scope

- ソクラテス式対話マネージャの実装
- 対話コンテキスト管理
- 質問生成ロジック（プロンプトテンプレート）
- 回答分析ロジック
- 対話状態の追跡
- ユニットテスト・統合テスト

### Out of Scope（本フェーズ対象外）

- 3段階ヒントシステム（別フェーズで実装）
- 感情認識と適応的アプローチ（Phase 2）
- 音声認識・音声合成（STT/TTS）の実装（Gemini Live APIが担当）
- フロントエンドUI
- データベース永続化（Firestore/BigQuery）
- 保護者向け機能

---

## 成功基準

1. **テスト通過**: すべてのユニットテスト・統合テストが通過する
2. **カバレッジ達成**: テストカバレッジ80%以上
3. **受け入れ条件の充足**:
   - 理解確認質問が適切に生成される
   - 対話コンテキストが正しく維持される
   - 5ターン以内に誘導できる（手動テストで確認）
   - 同じ質問が連続しない

---

## 参考資料

- `docs/product-requirements.md`: セクション 5.1 ソクラテス式対話エンジン
- `docs/functional-design.md`: セクション 3.1 ソクラテス式対話マネージャ
- `CLAUDE.md`: Architecture Principles > ソクラテス式対話エンジン
