# Requirements - Session Content Integration

## 背景・目的

SSEクライアント（`useDialogue`フック）が完成したため、これをセッションページ（`SessionContent`）に統合し、バックエンドとの対話を可能にする。

現在のSessionContentは:
- 対話履歴の表示は実装済み
- 音声録音UIは実装済み（ただし送信機能なし）
- セッション作成・管理が未実装
- useDialogueフックが未統合

## 要求事項

### 機能要件

1. **セッション管理**
   - ページ読み込み時にセッションを自動作成
   - セッションIDをJotai atomに保存
   - セッション終了時にクリーンアップ

2. **対話統合**
   - useDialogueフックをSessionContentに統合
   - メッセージ送信→SSEレスポンス受信→対話履歴更新のフロー実現
   - 送信中のローディング状態をUIに反映

3. **テキスト入力UI（MVP）**
   - 音声→テキスト変換はフェーズ2のため、MVPではテキスト入力を追加
   - 音声録音ボタンと併用（将来の音声連携に備える）

4. **エラーハンドリング**
   - セッション作成失敗時のエラー表示
   - 対話送信失敗時のリトライUI

### 非機能要件

- テストカバレッジ80%以上を維持
- アクセシビリティ（キーボード操作、aria属性）
- 低学年向けの分かりやすいUI

### 制約条件

- 音声→テキスト変換は本スコープ外（テキスト入力で代替）
- 既存のコンポーネント構造を大きく変更しない

## 対象範囲

### In Scope

- セッションAPIクライアント（`lib/api/sessionClient.ts`）
- useSessionフック（`lib/hooks/useSession.ts`）
- SessionContentへのuseDialogue統合
- テキスト入力UIコンポーネント
- 関連テスト

### Out of Scope

- 音声→テキスト変換（Cloud Speech-to-Text統合）
- 音声合成（TTS）
- 保護者向けダッシュボード
- 感情認識AI

## 成功基準

- [ ] セッションページでバックエンドとの対話が可能
- [ ] テキスト入力→送信→レスポンス表示のフローが動作
- [ ] エラー時に適切なフィードバックが表示される
- [ ] 全テストがパス
- [ ] bun lint / bun typecheck がパス
