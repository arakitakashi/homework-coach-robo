# Requirements - 3段階ヒントシステム

## 背景・目的

宿題コーチロボットのコア哲学は「答えを教えない」ことです。子供が「答えをすぐ教えて」と要求した場合でも、段階的にサポートし、子供が自分で考え、自分で気づくプロセスを支援します。

現在のSocraticDialogueManagerには `current_hint_level`（1-3）が存在しますが、各レベルで**どのようなサポートを提供するか**の具体的な実装がありません。

## 要求事項

### 機能要件

#### 3段階ヒントシステム

| レベル | 名称 | サポート内容 |
|--------|------|-------------|
| レベル1 | 問題理解の確認 | 問題文の再確認を促す。「この問題は何を聞いているかな？」「問題をもう一度読んでみよう」 |
| レベル2 | 既習事項の想起 | 関連する知識を思い出させる。「前に似たような問題をやったよね」「○○のことを思い出してみて」 |
| レベル3 | 部分的支援 | 問題を小さく分解し、最初の部分のみ支援。「まず最初のステップだけ一緒にやってみよう」 |

#### 段階スキップの禁止

- 子供が「答えを教えて」と言っても、**必ずレベル1から順番に**提供
- レベル1で理解できなかった場合のみレベル2へ
- レベル2でも難しい場合のみレベル3へ
- 各レベルで最低2ターンは対話を試みる

#### 「答えを教えて」リクエストの検出

子供の発話から「答えを教えてほしい」意図を検出する：
- 明示的: 「答え教えて」「わからない、教えて」「もう答え言って」
- 暗示的: 「できない」「むずかしい」「ギブアップ」

検出時は励まし + 現在のヒントレベルに応じたサポートを提供。

### 非機能要件

- テストカバレッジ80%以上
- 既存のSocraticDialogueManager, DialogueContextとの互換性
- LLMクライアントはモック可能（テスタビリティ）

### 制約条件

- レベル3でも最終的な答えは教えない（最初のステップのみサポート）
- 各レベルの対話トーンは状況に応じて決定（既存のdetermine_tone()を活用）

## 対象範囲

### In Scope

- HintLevel Enumの追加
- 各ヒントレベル用のプロンプトテンプレート
- ヒントレベルに応じた質問生成ロジック
- 「答えを教えて」リクエストの検出
- レベル遷移ロジック（既存should_move_to_next_phase()の拡張）
- ユニットテスト・統合テスト

### Out of Scope

- API エンドポイント統合（別タスク）
- 音声感情認識との連携（Phase 2）
- 保護者向けダッシュボード（Phase 2）
- 実際のLLMとの接続（テストではモック使用）

## 成功基準

1. 3段階すべてのヒントレベルが正しく動作する
2. レベルスキップが発生しない（必ず順番に提供）
3. 「答えを教えて」リクエストを正しく検出できる
4. テストカバレッジ80%以上
5. 既存のテストがすべてパス
