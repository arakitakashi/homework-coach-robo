# Design - タブレット横長レイアウト最適化

## アーキテクチャ概要

SessionContentコンポーネントのレイアウトを、タブレット横長画面に最適化された2カラムレイアウトに変更する。

### レイアウト構造

```
┌──────────────────────────────────────────────────────────────┐
│ ヘッダー (grid-col: 1/-1)                                    │
│ ヒント・ポイント・エージェント・終了ボタン                  │
├───────────────────┬──────────────────────────────────────────┤
│                   │                                          │
│ 左サイドバー      │ メインエリア                             │
│ (grid-col: 1)     │ (grid-col: 2)                            │
│                   │                                          │
│ - キャラクター    │ - 対話履歴 (flex-1, overflow-auto)       │
│ - ツール実行      │                                          │
│ - 感情            │                                          │
│ - 進捗            │                                          │
│ - ストーリー      │                                          │
│                   ├──────────────────────────────────────────┤
│                   │ テキスト入力                             │
│                   ├──────────────────────────────────────────┤
│                   │ 音声インターフェース                     │
└───────────────────┴──────────────────────────────────────────┘
```

### ブレークポイント戦略

1. **モバイル（< 768px）**: 既存の縦長レイアウト（変更なし）
2. **タブレット横長（768px - 1023px）**: 2カラムレイアウト（サイドバー280px）
3. **タブレット大・デスクトップ（≥ 1024px）**: 2カラムレイアウト（サイドバー360px）

## 技術選定

### レイアウト実装

**CSS Grid** を採用（Tailwind CSSのgridユーティリティ）

理由：
- 複雑な2次元レイアウトに最適
- ブレークポイントごとのレイアウト切り替えが容易
- メインテナンス性が高い
- Tailwind CSSの `grid-cols-*` と組み合わせやすい

### レスポンシブ対応

Tailwind CSSのレスポンシブプレフィックスを使用：
- デフォルト（モバイル）: `flex flex-col`
- タブレット: `md:grid md:grid-cols-[280px_1fr]`
- デスクトップ: `lg:grid-cols-[360px_1fr]`

## データ設計

既存のJotai atomsを変更せず、レイアウトのみ変更するため、データ設計の変更なし。

## ファイル構成

```
frontend/src/app/session/
├── SessionContent.tsx          # 変更: レイアウト構造を変更
├── SessionContent.test.tsx     # 変更: テスト更新
├── SessionLayout.tsx           # 新規: レイアウトコンポーネント（分離）
└── SessionLayout.test.tsx      # 新規: レイアウトテスト
```

## 実装アプローチ

### Option 1: SessionContent内でレイアウト変更（採用）

**メリット**:
- 既存コンポーネント構造を維持
- 変更範囲が最小
- テスト変更が少ない

**実装**:
```tsx
<main className="flex min-h-screen flex-col md:grid md:grid-cols-[280px_1fr] lg:grid-cols-[360px_1fr]">
  <header className="md:col-span-2">...</header>
  <aside className="md:flex md:flex-col">
    {/* サイドバーコンポーネント */}
  </aside>
  <section className="md:flex md:flex-col">
    {/* メインエリアコンポーネント */}
  </section>
</main>
```

### Option 2: SessionLayoutコンポーネント分離（不採用）

**デメリット**:
- 既存コンポーネント構造の大幅変更
- テスト変更が多い
- props drilling の増加

## エラーハンドリング

レイアウト変更のみのため、既存のエラーハンドリングを維持：
- セッション作成エラー: 既存のErrorMessage表示
- 対話エラー: 既存のErrorMessage表示

## セキュリティ考慮事項

レイアウト変更のみのため、セキュリティ影響なし。

## パフォーマンス考慮事項

### レンダリング最適化

1. **対話履歴のスクロール最適化**
   - `overflow-auto` のみでスクロール実装
   - 仮想化は現時点では不要（履歴数が限定的）

2. **CSS Grid のパフォーマンス**
   - CSS Gridはブラウザネイティブで高速
   - JavaScriptによる動的計算不要

3. **レスポンシブ切り替え**
   - Tailwind CSSのブレークポイントはCSSメディアクエリで実装
   - JavaScriptによる動的切り替え不要

## 代替案と採用理由

### 代替案1: Flexboxのみで実装

**不採用理由**:
- 2次元レイアウトにはGridの方が適切
- サイドバーの高さ調整が複雑

### 代替案2: 既存レイアウトを維持し、スクロール最適化のみ

**不採用理由**:
- タブレット横長画面の利点を活かせない
- ユーザー要求（スクロールなしで全体表示）を満たせない

### 採用案: CSS Gridで2カラムレイアウト

**採用理由**:
- タブレット横長画面に最適
- スクロールなしで全体表示可能
- 既存コンポーネントの再利用が容易
- Tailwind CSSとの親和性が高い
- メインテナンス性が高い

## デザイン詳細

### カラースキーム

既存のカラースキームを維持：
- 背景: `bg-gradient-to-b from-blue-50 to-purple-50`
- サイドバー: 半透明カード `bg-white/80 backdrop-blur-sm`
- アクセント: 既存のボタン・バッジカラー

### スペーシング

- ヘッダー高さ: `h-16`（64px）
- サイドバー幅: `280px`（md）、`360px`（lg）
- パディング: `p-4`（16px）
- ギャップ: `gap-4`（16px）

### タイポグラフィ

既存のフォントサイズを維持：
- ヘッダー: `text-base`（16px）
- ボディ: `text-sm`（14px）
- キャラクター: サイズ調整なし

### アニメーション

既存のFramer Motionアニメーションを維持：
- BadgeNotification: フロート表示（変更なし）
- AgentIndicator: トランジションアニメーション（変更なし）
- EmotionIndicator: フェードイン/アウト（変更なし）

レイアウト切り替え時のアニメーションは不要（CSSのみで滑らか）。
